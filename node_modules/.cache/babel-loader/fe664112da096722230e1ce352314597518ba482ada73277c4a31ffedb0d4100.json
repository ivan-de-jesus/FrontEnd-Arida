{"ast":null,"code":"// api/landsat.js  (un micro-servicio Node; sin dependencias externas)\nimport axios from 'axios';\n\n// Helper: STAC search en Planetary Computer\nexport async function searchLandsat({\n  lat,\n  lng,\n  date\n}) {\n  const body = {\n    collections: ['landsat-8-c2-l2'],\n    intersects: {\n      type: 'Point',\n      coordinates: [lng, lat]\n    },\n    datetime: `${date || new Date().toISOString().split('T')[0]}/P5D`,\n    limit: 1,\n    query: {\n      'eo:cloud_cover': {\n        lt: 10\n      }\n    }\n  };\n  const {\n    data\n  } = await axios.post('https://planetarycomputer.microsoft.com/api/stac/v1/search', body, {\n    headers: {\n      'Content-Type': 'application/json'\n    }\n  });\n  if (!data.features.length) throw new Error('Sin escenas Landsat 8 en el rango.');\n  const item = data.features[0];\n  // PlanetaryComputer exige firma SAS; basta anteponer ?api-key=...\n  const sign = href => `${href}?${item.assets()['B4'].href.split('?')[1]}`;\n  return {\n    metadata: {\n      scene: item.id,\n      acquired: item.properties['datetime'],\n      cloud: item.properties['eo:cloud_cover'],\n      sunAz: item.properties['view:sun_azimuth'],\n      sunEl: item.properties['view:sun_elevation']\n    },\n    assets: {\n      quicklook: sign(item.assets['preview'].href),\n      srBands: {\n        B4: sign(item.assets['SR_B4'].href),\n        // rojo\n        B5: sign(item.assets['SR_B5'].href) // NIR\n      },\n      lst: sign(item.assets['ST_B10'].href) // Land-Surface Temp.\n    }\n  };\n}","map":{"version":3,"names":["axios","searchLandsat","lat","lng","date","body","collections","intersects","type","coordinates","datetime","Date","toISOString","split","limit","query","lt","data","post","headers","features","length","Error","item","sign","href","assets","metadata","scene","id","acquired","properties","cloud","sunAz","sunEl","quicklook","srBands","B4","B5","lst"],"sources":["C:/Users/ivan.djgonzalez/Desktop/fotoMapa/photo-gps-viewer/src/api/landsat.js"],"sourcesContent":["// api/landsat.js  (un micro-servicio Node; sin dependencias externas)\r\nimport axios from 'axios'\r\n\r\n// Helper: STAC search en Planetary Computer\r\nexport async function searchLandsat ({ lat, lng, date }) {\r\n  const body = {\r\n    collections: ['landsat-8-c2-l2'],\r\n    intersects: { type: 'Point', coordinates: [lng, lat] },\r\n    datetime: `${date || new Date().toISOString().split('T')[0]}/P5D`,\r\n    limit: 1,\r\n    query: { 'eo:cloud_cover': { lt: 10 } }\r\n  }\r\n\r\n  const { data } = await axios.post(\r\n    'https://planetarycomputer.microsoft.com/api/stac/v1/search',\r\n    body,\r\n    { headers: { 'Content-Type': 'application/json' } }\r\n  )\r\n  if (!data.features.length) throw new Error('Sin escenas Landsat 8 en el rango.')\r\n\r\n  const item = data.features[0]\r\n  // PlanetaryComputer exige firma SAS; basta anteponer ?api-key=...\r\n  const sign = (href) => `${href}?${item.assets()['B4'].href.split('?')[1]}`\r\n\r\n  return {\r\n    metadata: {\r\n      scene: item.id,\r\n      acquired: item.properties['datetime'],\r\n      cloud: item.properties['eo:cloud_cover'],\r\n      sunAz: item.properties['view:sun_azimuth'],\r\n      sunEl: item.properties['view:sun_elevation']\r\n    },\r\n    assets: {\r\n      quicklook: sign(item.assets['preview'].href),\r\n      srBands: {\r\n        B4: sign(item.assets['SR_B4'].href), // rojo\r\n        B5: sign(item.assets['SR_B5'].href)  // NIR\r\n      },\r\n      lst: sign(item.assets['ST_B10'].href)  // Land-Surface Temp.\r\n    }\r\n  }\r\n}\r\n"],"mappings":"AAAA;AACA,OAAOA,KAAK,MAAM,OAAO;;AAEzB;AACA,OAAO,eAAeC,aAAaA,CAAE;EAAEC,GAAG;EAAEC,GAAG;EAAEC;AAAK,CAAC,EAAE;EACvD,MAAMC,IAAI,GAAG;IACXC,WAAW,EAAE,CAAC,iBAAiB,CAAC;IAChCC,UAAU,EAAE;MAAEC,IAAI,EAAE,OAAO;MAAEC,WAAW,EAAE,CAACN,GAAG,EAAED,GAAG;IAAE,CAAC;IACtDQ,QAAQ,EAAE,GAAGN,IAAI,IAAI,IAAIO,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM;IACjEC,KAAK,EAAE,CAAC;IACRC,KAAK,EAAE;MAAE,gBAAgB,EAAE;QAAEC,EAAE,EAAE;MAAG;IAAE;EACxC,CAAC;EAED,MAAM;IAAEC;EAAK,CAAC,GAAG,MAAMjB,KAAK,CAACkB,IAAI,CAC/B,4DAA4D,EAC5Db,IAAI,EACJ;IAAEc,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB;EAAE,CACpD,CAAC;EACD,IAAI,CAACF,IAAI,CAACG,QAAQ,CAACC,MAAM,EAAE,MAAM,IAAIC,KAAK,CAAC,oCAAoC,CAAC;EAEhF,MAAMC,IAAI,GAAGN,IAAI,CAACG,QAAQ,CAAC,CAAC,CAAC;EAC7B;EACA,MAAMI,IAAI,GAAIC,IAAI,IAAK,GAAGA,IAAI,IAAIF,IAAI,CAACG,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAACD,IAAI,CAACZ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE;EAE1E,OAAO;IACLc,QAAQ,EAAE;MACRC,KAAK,EAAEL,IAAI,CAACM,EAAE;MACdC,QAAQ,EAAEP,IAAI,CAACQ,UAAU,CAAC,UAAU,CAAC;MACrCC,KAAK,EAAET,IAAI,CAACQ,UAAU,CAAC,gBAAgB,CAAC;MACxCE,KAAK,EAAEV,IAAI,CAACQ,UAAU,CAAC,kBAAkB,CAAC;MAC1CG,KAAK,EAAEX,IAAI,CAACQ,UAAU,CAAC,oBAAoB;IAC7C,CAAC;IACDL,MAAM,EAAE;MACNS,SAAS,EAAEX,IAAI,CAACD,IAAI,CAACG,MAAM,CAAC,SAAS,CAAC,CAACD,IAAI,CAAC;MAC5CW,OAAO,EAAE;QACPC,EAAE,EAAEb,IAAI,CAACD,IAAI,CAACG,MAAM,CAAC,OAAO,CAAC,CAACD,IAAI,CAAC;QAAE;QACrCa,EAAE,EAAEd,IAAI,CAACD,IAAI,CAACG,MAAM,CAAC,OAAO,CAAC,CAACD,IAAI,CAAC,CAAE;MACvC,CAAC;MACDc,GAAG,EAAEf,IAAI,CAACD,IAAI,CAACG,MAAM,CAAC,QAAQ,CAAC,CAACD,IAAI,CAAC,CAAE;IACzC;EACF,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}