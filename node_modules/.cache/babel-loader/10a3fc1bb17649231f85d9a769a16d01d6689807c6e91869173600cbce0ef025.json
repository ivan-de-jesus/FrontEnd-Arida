{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { Loader } from '@googlemaps/js-api-loader';\nimport { searchLandsat } from '@/api/landsat';\nexport default {\n  name: 'MapView',\n  props: {\n    coords: {\n      type: Object,\n      required: true\n    }\n  },\n  data() {\n    return {\n      map: null\n    };\n  },\n  async mounted() {\n    const {\n      latitude: lat,\n      longitude: lng\n    } = this.coords;\n\n    // 1️⃣ Intentar cargar Google Maps y marcador\n    try {\n      const google = await new Loader({\n        apiKey: process.env.VUE_APP_GOOGLE_KEY,\n        version: 'weekly'\n      }).load();\n      this.map = new google.maps.Map(document.getElementById('map'), {\n        center: {\n          lat,\n          lng\n        },\n        zoom: 15,\n        disableDefaultUI: true\n      });\n      new google.maps.Marker({\n        position: {\n          lat,\n          lng\n        },\n        map: this.map\n      });\n    } catch (err) {\n      console.warn('Google Maps no se pudo cargar:', err);\n    }\n\n    // 2️⃣ Calcular NDWI medio y emitir el semáforo\n    try {\n      const ls8 = await searchLandsat({\n        lat,\n        lng\n      });\n\n      // Área de ~100 m alrededor\n      const buffer = 0.001;\n      const geom = {\n        type: 'Polygon',\n        coordinates: [[[lng - buffer, lat - buffer], [lng - buffer, lat + buffer], [lng + buffer, lat + buffer], [lng + buffer, lat - buffer], [lng - buffer, lat - buffer]]]\n      };\n\n      // Endpoint para agregar NDWI\n      const expr = '(nir08 - swir16) / (nir08 + swir16)';\n      const urlAgg = 'https://planetarycomputer.microsoft.com/api/data/v1/item/aggregate' + `?collection=landsat-c2-l2&item=${ls8.itemId}` + '&assets=nir08,swir16' + `&expression=${encodeURIComponent(expr)}` + `&geom=${encodeURIComponent(JSON.stringify(geom))}` + (ls8.sas ? `&${ls8.sas}` : '');\n      const response = await fetch(urlAgg);\n      const json = await response.json();\n      const meanNdwi = json.result?.mean ?? null;\n\n      // Determinar estado\n      let status;\n      if (meanNdwi === null) status = 'Sin datos';else if (meanNdwi < 0.10) status = 'Seco';else if (meanNdwi < 0.25) status = 'Medio';else status = 'Húmedo';\n      this.$emit('ndwi-status', {\n        ndwi: meanNdwi,\n        status\n      });\n    } catch (error) {\n      console.error('Error calculando NDWI:', error);\n      this.$emit('ndwi-status', {\n        ndwi: null,\n        status: 'Sin datos'\n      });\n    }\n  }\n};","map":{"version":3,"names":["Loader","searchLandsat","name","props","coords","type","Object","required","data","map","mounted","latitude","lat","longitude","lng","google","apiKey","process","env","VUE_APP_GOOGLE_KEY","version","load","maps","Map","document","getElementById","center","zoom","disableDefaultUI","Marker","position","err","console","warn","ls8","buffer","geom","coordinates","expr","urlAgg","itemId","encodeURIComponent","JSON","stringify","sas","response","fetch","json","meanNdwi","result","mean","status","$emit","ndwi","error"],"sources":["src/components/MapView.vue"],"sourcesContent":["<template>\r\n  <div id=\"map\" class=\"w-100 rounded shadow\" style=\"height:350px; position: relative;\">\r\n    <!-- Mapa se inicializa aquí -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Loader } from '@googlemaps/js-api-loader'\r\nimport { searchLandsat } from '@/api/landsat'\r\n\r\nexport default {\r\n  name: 'MapView',\r\n  props: {\r\n    coords: { type: Object, required: true }\r\n  },\r\n  data() {\r\n    return { map: null }\r\n  },\r\n  async mounted() {\r\n    const { latitude: lat, longitude: lng } = this.coords\r\n\r\n    // 1️⃣ Intentar cargar Google Maps y marcador\r\n    try {\r\n      const google = await new Loader({\r\n        apiKey : process.env.VUE_APP_GOOGLE_KEY,\r\n        version: 'weekly'\r\n      }).load()\r\n\r\n      this.map = new google.maps.Map(document.getElementById('map'), {\r\n        center           : { lat, lng },\r\n        zoom             : 15,\r\n        disableDefaultUI : true\r\n      })\r\n      new google.maps.Marker({ position: { lat, lng }, map: this.map })\r\n    } catch (err) {\r\n      console.warn('Google Maps no se pudo cargar:', err)\r\n    }\r\n\r\n    // 2️⃣ Calcular NDWI medio y emitir el semáforo\r\n    try {\r\n      const ls8 = await searchLandsat({ lat, lng })\r\n\r\n      // Área de ~100 m alrededor\r\n      const buffer = 0.001\r\n      const geom = {\r\n        type       : 'Polygon',\r\n        coordinates: [[\r\n          [lng - buffer, lat - buffer],\r\n          [lng - buffer, lat + buffer],\r\n          [lng + buffer, lat + buffer],\r\n          [lng + buffer, lat - buffer],\r\n          [lng - buffer, lat - buffer]\r\n        ]]\r\n      }\r\n\r\n      // Endpoint para agregar NDWI\r\n      const expr = '(nir08 - swir16) / (nir08 + swir16)'\r\n      const urlAgg =\r\n        'https://planetarycomputer.microsoft.com/api/data/v1/item/aggregate'\r\n        + `?collection=landsat-c2-l2&item=${ls8.itemId}`\r\n        + '&assets=nir08,swir16'\r\n        + `&expression=${encodeURIComponent(expr)}`\r\n        + `&geom=${encodeURIComponent(JSON.stringify(geom))}`\r\n        + (ls8.sas ? `&${ls8.sas}` : '')\r\n\r\n      const response = await fetch(urlAgg)\r\n      const json     = await response.json()\r\n      const meanNdwi = json.result?.mean ?? null\r\n\r\n      // Determinar estado\r\n      let status\r\n      if (meanNdwi === null) status = 'Sin datos'\r\n      else if (meanNdwi < 0.10) status = 'Seco'\r\n      else if (meanNdwi < 0.25) status = 'Medio'\r\n      else status = 'Húmedo'\r\n\r\n      this.$emit('ndwi-status', { ndwi: meanNdwi, status })\r\n    } catch (error) {\r\n      console.error('Error calculando NDWI:', error)\r\n      this.$emit('ndwi-status', { ndwi: null, status: 'Sin datos' })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n#map {\r\n  position: relative;\r\n}\r\n</style>\r\n"],"mappings":";;AAOA,SAAAA,MAAA;AACA,SAAAC,aAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACAC,MAAA;MAAAC,IAAA,EAAAC,MAAA;MAAAC,QAAA;IAAA;EACA;EACAC,KAAA;IACA;MAAAC,GAAA;IAAA;EACA;EACA,MAAAC,QAAA;IACA;MAAAC,QAAA,EAAAC,GAAA;MAAAC,SAAA,EAAAC;IAAA,SAAAV,MAAA;;IAEA;IACA;MACA,MAAAW,MAAA,aAAAf,MAAA;QACAgB,MAAA,EAAAC,OAAA,CAAAC,GAAA,CAAAC,kBAAA;QACAC,OAAA;MACA,GAAAC,IAAA;MAEA,KAAAZ,GAAA,OAAAM,MAAA,CAAAO,IAAA,CAAAC,GAAA,CAAAC,QAAA,CAAAC,cAAA;QACAC,MAAA;UAAAd,GAAA;UAAAE;QAAA;QACAa,IAAA;QACAC,gBAAA;MACA;MACA,IAAAb,MAAA,CAAAO,IAAA,CAAAO,MAAA;QAAAC,QAAA;UAAAlB,GAAA;UAAAE;QAAA;QAAAL,GAAA,OAAAA;MAAA;IACA,SAAAsB,GAAA;MACAC,OAAA,CAAAC,IAAA,mCAAAF,GAAA;IACA;;IAEA;IACA;MACA,MAAAG,GAAA,SAAAjC,aAAA;QAAAW,GAAA;QAAAE;MAAA;;MAEA;MACA,MAAAqB,MAAA;MACA,MAAAC,IAAA;QACA/B,IAAA;QACAgC,WAAA,IACA,CAAAvB,GAAA,GAAAqB,MAAA,EAAAvB,GAAA,GAAAuB,MAAA,GACA,CAAArB,GAAA,GAAAqB,MAAA,EAAAvB,GAAA,GAAAuB,MAAA,GACA,CAAArB,GAAA,GAAAqB,MAAA,EAAAvB,GAAA,GAAAuB,MAAA,GACA,CAAArB,GAAA,GAAAqB,MAAA,EAAAvB,GAAA,GAAAuB,MAAA,GACA,CAAArB,GAAA,GAAAqB,MAAA,EAAAvB,GAAA,GAAAuB,MAAA,EACA;MACA;;MAEA;MACA,MAAAG,IAAA;MACA,MAAAC,MAAA,GACA,uEACA,kCAAAL,GAAA,CAAAM,MAAA,KACA,yBACA,eAAAC,kBAAA,CAAAH,IAAA,MACA,SAAAG,kBAAA,CAAAC,IAAA,CAAAC,SAAA,CAAAP,IAAA,QACAF,GAAA,CAAAU,GAAA,OAAAV,GAAA,CAAAU,GAAA;MAEA,MAAAC,QAAA,SAAAC,KAAA,CAAAP,MAAA;MACA,MAAAQ,IAAA,SAAAF,QAAA,CAAAE,IAAA;MACA,MAAAC,QAAA,GAAAD,IAAA,CAAAE,MAAA,EAAAC,IAAA;;MAEA;MACA,IAAAC,MAAA;MACA,IAAAH,QAAA,WAAAG,MAAA,oBACA,IAAAH,QAAA,SAAAG,MAAA,eACA,IAAAH,QAAA,SAAAG,MAAA,gBACAA,MAAA;MAEA,KAAAC,KAAA;QAAAC,IAAA,EAAAL,QAAA;QAAAG;MAAA;IACA,SAAAG,KAAA;MACAtB,OAAA,CAAAsB,KAAA,2BAAAA,KAAA;MACA,KAAAF,KAAA;QAAAC,IAAA;QAAAF,MAAA;MAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}