{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { Loader } from '@googlemaps/js-api-loader';\nimport { searchLandsat } from '@/api/landsat';\nimport { sampleNdwi } from '@/utils/ndwi-client';\nexport default {\n  name: 'MapView',\n  props: {\n    coords: {\n      type: Object,\n      required: true\n    } // { latitude, longitude }\n  },\n  data() {\n    return {\n      map: null\n    };\n  },\n  async mounted() {\n    const {\n      latitude: lat,\n      longitude: lng\n    } = this.coords;\n    /* 1 · Google Maps */\n    try {\n      const google = await new Loader({\n        apiKey: process.env.VUE_APP_GOOGLE_KEY,\n        version: 'weekly'\n      }).load();\n      this.map = new google.maps.Map(document.getElementById('map'), {\n        center: {\n          lat,\n          lng\n        },\n        zoom: 15,\n        disableDefaultUI: true\n      });\n      new google.maps.Marker({\n        position: {\n          lat,\n          lng\n        },\n        map: this.map\n      });\n    } catch (err) {\n      console.warn('Google Maps no se pudo cargar:', err);\n    }\n\n    /* 2-6 · NDWI */\n    let meanNdwi = null;\n    let status = 'Sin datos';\n    try {\n      const ls8 = await searchLandsat({\n        lat,\n        lng\n      });\n      const blobNir = ls8.assets.nir08.split('?')[0];\n      const blobSwir = ls8.assets.swir16.split('?')[0];\n      console.log(\"Entro aqui\");\n      const token = (await fetch('https://planetarycomputer.microsoft.com/api/sas/v1/token/landsateuwest/landsat-c2').then(r => r.json())).token;\n      const nirUrl = `${blobNir}?${token}`;\n      const swirUrl = `${blobSwir}?${token}`;\n      meanNdwi = await sampleNdwi(nirUrl, swirUrl, lat, lng);\n      if (meanNdwi !== null) {\n        if (meanNdwi < 0.10) status = 'Seco';else if (meanNdwi < 0.25) status = 'Medio';else status = 'Húmedo';\n      }\n    } catch (e) {\n      console.error('Error NDWI:', e);\n    }\n    this.$emit('ndwi-status', {\n      ndwi: meanNdwi,\n      status\n    });\n  }\n};","map":{"version":3,"names":["Loader","searchLandsat","sampleNdwi","name","props","coords","type","Object","required","data","map","mounted","latitude","lat","longitude","lng","google","apiKey","process","env","VUE_APP_GOOGLE_KEY","version","load","maps","Map","document","getElementById","center","zoom","disableDefaultUI","Marker","position","err","console","warn","meanNdwi","status","ls8","blobNir","assets","nir08","split","blobSwir","swir16","log","token","fetch","then","r","json","nirUrl","swirUrl","e","error","$emit","ndwi"],"sources":["src/components/MapView.vue"],"sourcesContent":["<template>\r\n  <div id=\"map\"\r\n       class=\"w-100 rounded shadow\"\r\n       style=\"height: 350px; position: relative;\">\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Loader }        from '@googlemaps/js-api-loader'\r\nimport { searchLandsat } from '@/api/landsat'\r\nimport { sampleNdwi }    from '@/utils/ndwi-client'\r\n\r\nexport default {\r\n  name: 'MapView',\r\n  props: {\r\n    coords: { type: Object, required: true }   // { latitude, longitude }\r\n  },\r\n  data () { return { map: null } },\r\n  async mounted () {\r\n    const { latitude: lat, longitude: lng } = this.coords\r\n    /* 1 · Google Maps */\r\n    try {\r\n      const google = await new Loader({\r\n        apiKey: process.env.VUE_APP_GOOGLE_KEY,\r\n        version: 'weekly'\r\n      }).load()\r\n\r\n      this.map = new google.maps.Map(\r\n        document.getElementById('map'),\r\n        { center: { lat, lng }, zoom: 15, disableDefaultUI: true }\r\n      )\r\n      new google.maps.Marker({ position: { lat, lng }, map: this.map })\r\n    } catch (err) {\r\n      console.warn('Google Maps no se pudo cargar:', err)\r\n    }\r\n\r\n    /* 2-6 · NDWI */\r\n    let meanNdwi = null\r\n    let status   = 'Sin datos'\r\n\r\n    try {\r\n      const ls8 = await searchLandsat({ lat, lng })\r\n      const blobNir  = ls8.assets.nir08.split('?')[0]\r\n      const blobSwir = ls8.assets.swir16.split('?')[0]\r\nconsole.log(\"Entro aqui\")\r\n      const token = (await fetch(\r\n        'https://planetarycomputer.microsoft.com/api/sas/v1/token/landsateuwest/landsat-c2'\r\n      ).then(r => r.json())).token\r\n\r\n      const nirUrl  = `${blobNir}?${token}`\r\n      const swirUrl = `${blobSwir}?${token}`\r\n\r\n      meanNdwi = await sampleNdwi(nirUrl, swirUrl, lat, lng)\r\n\r\n      if (meanNdwi !== null) {\r\n        if (meanNdwi < 0.10)      status = 'Seco'\r\n        else if (meanNdwi < 0.25) status = 'Medio'\r\n        else                      status = 'Húmedo'\r\n      }\r\n    } catch (e) {\r\n      console.error('Error NDWI:', e)\r\n    }\r\n\r\n    this.$emit('ndwi-status', { ndwi: meanNdwi, status })\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n#map { position: relative; }\r\n</style>\r\n"],"mappings":";;AAQA,SAAAA,MAAA;AACA,SAAAC,aAAA;AACA,SAAAC,UAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACAC,MAAA;MAAAC,IAAA,EAAAC,MAAA;MAAAC,QAAA;IAAA;EACA;EACAC,KAAA;IAAA;MAAAC,GAAA;IAAA;EAAA;EACA,MAAAC,QAAA;IACA;MAAAC,QAAA,EAAAC,GAAA;MAAAC,SAAA,EAAAC;IAAA,SAAAV,MAAA;IACA;IACA;MACA,MAAAW,MAAA,aAAAhB,MAAA;QACAiB,MAAA,EAAAC,OAAA,CAAAC,GAAA,CAAAC,kBAAA;QACAC,OAAA;MACA,GAAAC,IAAA;MAEA,KAAAZ,GAAA,OAAAM,MAAA,CAAAO,IAAA,CAAAC,GAAA,CACAC,QAAA,CAAAC,cAAA,SACA;QAAAC,MAAA;UAAAd,GAAA;UAAAE;QAAA;QAAAa,IAAA;QAAAC,gBAAA;MAAA,CACA;MACA,IAAAb,MAAA,CAAAO,IAAA,CAAAO,MAAA;QAAAC,QAAA;UAAAlB,GAAA;UAAAE;QAAA;QAAAL,GAAA,OAAAA;MAAA;IACA,SAAAsB,GAAA;MACAC,OAAA,CAAAC,IAAA,mCAAAF,GAAA;IACA;;IAEA;IACA,IAAAG,QAAA;IACA,IAAAC,MAAA;IAEA;MACA,MAAAC,GAAA,SAAApC,aAAA;QAAAY,GAAA;QAAAE;MAAA;MACA,MAAAuB,OAAA,GAAAD,GAAA,CAAAE,MAAA,CAAAC,KAAA,CAAAC,KAAA;MACA,MAAAC,QAAA,GAAAL,GAAA,CAAAE,MAAA,CAAAI,MAAA,CAAAF,KAAA;MACAR,OAAA,CAAAW,GAAA;MACA,MAAAC,KAAA,UAAAC,KAAA,CACA,mFACA,EAAAC,IAAA,CAAAC,CAAA,IAAAA,CAAA,CAAAC,IAAA,KAAAJ,KAAA;MAEA,MAAAK,MAAA,MAAAZ,OAAA,IAAAO,KAAA;MACA,MAAAM,OAAA,MAAAT,QAAA,IAAAG,KAAA;MAEAV,QAAA,SAAAjC,UAAA,CAAAgD,MAAA,EAAAC,OAAA,EAAAtC,GAAA,EAAAE,GAAA;MAEA,IAAAoB,QAAA;QACA,IAAAA,QAAA,SAAAC,MAAA,eACA,IAAAD,QAAA,SAAAC,MAAA,gBACAA,MAAA;MACA;IACA,SAAAgB,CAAA;MACAnB,OAAA,CAAAoB,KAAA,gBAAAD,CAAA;IACA;IAEA,KAAAE,KAAA;MAAAC,IAAA,EAAApB,QAAA;MAAAC;IAAA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}